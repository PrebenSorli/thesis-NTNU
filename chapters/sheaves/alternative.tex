\documentclass[../../thesis.tex]{subfiles}
\begin{document}
\begin{theorem}[{\cite[Theorem 7.3.4.9]{HTT}}]\label{7.3.4.9}
    Let $X$ be locally compact and Hausdorff and $\C$ an $\infty$-category  with small limits and colimits and left exact filtered colimits.
    Let $\F \colon (\Open(X) \cup \K(X))^{op} \to \C$.
    The following conditions are equivalent:
    \begin{enumerate}[]
        \item The presheaf $\F_{\K}:= \F|_{\K(X)^{op}}$ is a $\K$-sheaf, and $\F$ is a right Kan extension of $\F_\K$.
        \item The presheaf $\F_{\Open}:=\F|_{\Open(X)^{op}}$ is a sheaf, and $\F$ is a left Kan extension of $\F_{\Open}$.
    \end{enumerate}
\end{theorem}
We will split the theorem into a few lemmas for readability and keep the notation in the theorem statement through the rest of the section.
\begin{lemma}
    If $\F_\K$ is a $\K$-sheaf, then $\F$ is a left Kan extension of $\F_{\Open}$.
\end{lemma}
\begin{proof}
    By definition we want to show that
    \[
        (\Open(X)_{/K}^{op})^{\triangleright} \hookrightarrow ((\Open(X)\cup \K(X))_{/K}^{op})^{\triangleright} \xrightarrow{c}(\Open(X) \cup \K(X))^{op}\xrightarrow{\F}\C
    \]
    is a colimit diagram in $\C$.
    The assumption that $\F_{\K}$ is a $\K$-sheaf means that for each $K\in \K(X)$, $\F_{\K}(K)$ is a colimit of $\F|\Nerve(\K_{K\Subset}(X))^{op}$.
    We will "transfer" this colimit to the colimit we want by colimit-cofinal maps
    \[
        (\Open(X)^{op})_{/K} \xrightarrow{p} ((\Open(X)\cup \K(X))_{/K}^{op}) \xleftarrow{p'}\K_{K\Subset}(X)^{op}.
    \]
    Recall that by Theorem \ref{superlemma} checking cofinality reduces to checking weak contractibility of certain simplicial sets.
    For $p$ we must check that the pullback $\Open(X)^{op}_{/K} \times_{(\Open(X)\cup \K(X))_{/K}^{op}} ((\Open(X)\cup \K(X))_{/K}^{op})_{K'/}$ is weakly contractible for every $K' \in (\Open(X)\cup \K(X))_{/K}^{op}$.
    This is the simplicial set obtained by taking the nerve of the partially ordered set $\{U \in \Open(X) \mid K\subseteq U \subseteq K'\}$.
    By \ref{5.3.1.20} filtered $\infty$-categories are weakly contractible, and our partially ordered set is filtered as it is nonempty and stable under finite unions, and taking nerves preserve the property of being filtered by \ref{NerveFilter}.
    The pullback we must check for $p'$ is given by $\{K'' \in \K(X) \mid K \Subset K'' \subseteq K'\}$ and is weakly contractible by exactly the same argument, and hence $p$ and $p'$ are colimit-cofinal maps.
    By colimit-cofinality of $p$ and $p'$, the diagram
    \[
        (\Open(X)^{op})^{\triangleright}_{/K} \hookrightarrow ((\Open(X)\cup \K(X))_{/K}^{op})^{\triangleright} \xrightarrow{c}(\Open(X) \cup \K(X))^{op}\xrightarrow{\F}\C
    \]
    is a colimit diagram if and only if
    \[
        ((\K(X)^{op}_{\Subset K}))^{\triangleright} \hookrightarrow ((\Open(X)\cup \K(X))_{/K}^{op})^{\triangleright} \xrightarrow{c}(\Open(X) \cup \K(X))^{op}\xrightarrow{\F}\C
    \]
    is a colimit diagram, which it is by the assumption that $\F_{\K}$ is a $\K$-sheaf.
\end{proof}
\begin{lemma}
    If $\F_\K$ is a $\K$-sheaf, and $\F$ is a right Kan extension of $\F_\K$, then $\F_{\Open}$ is a sheaf.
\end{lemma}
\begin{proof}
    By definition \ref{sheaf_on_top} we must show that for every $U\in \Open(X)$ and every covering sieve $\mathscr{W}$ covering $U$,
    \[
        \W^{\triangleright} \hookrightarrow \Open(X)_{/U}^{\triangleright} \rightarrow \Open(X)\xrightarrow{\F}\C^{op}
    \]
    is a colimit diagram, or equivalently that
    \[
        \W^{op,\triangleleft} \hookrightarrow \Open(X)_{/U}^{op,\triangleleft} \rightarrow \Open(X)^{op}\xrightarrow{\F}\C
    \]
    is a limit diagram.
    Let $\K_{\W}(X)$ be the set $\{K\in \K(X) \mid (\exists W \in \W) \text{ with }K \subseteq W \}$.
    We will once again use cofinality by observing that \ref{superlemma} implies  limit-cofinality of the inclusion
    \[
        \W \subseteq \W \cup \K_{\W}(X)
    \]
    if and only if, for any $Y \in \W \cup \K_{\W}(X)$ the simplicial set $\W\times_{\W \cup \K_{\W}(X)}\W \cup \K_{\W}(X)_{Y/}$ is weakly contractible.
    This fiber product is equivalent to the nerve of the partially ordered set $\{W' \in \W \mid [\exists W \in \W][K \subseteq W \subseteq Y]\}$ and this is filtered, and hence, the fiber product is weakly contractible by \ref{5.3.1.20} and \ref{NerveFilter}.\footnote{\TODO{Check this calculation is correct with Tallak or Rune.}}
    Therefore it is enough to show the limit starting from $ \W \cup \K_{\W}(X)^{op}$.
    By example \ref{KanCone} this is equivalent to showing $\F|_{(\W \cup \K_{\W}(X))^{op,\triangleleft}}$ is right Kan extended from $\F|_{(\W \cup \K_{\W}(X))^{op}}$.
    By the assumption that $\F$ is a right Kan extension of $\F_{\K}$ and the observation that
    \[
        \F(U) = \lim_{K\in \K(X)^{op}_{U/}}\F(K) = \lim_{K\in \K_{\W}(X)^{op}_{U/}}\F(K) %Do we need the following?= K_*^{\prime}\F(U)
    \]
    we see that $\F|_{(\W \cup \K_{\W})^{op}}$ is a right Kan extension of $\F|_{(K_{\W}(X))^{op}}$.
    Hence, it suffices to prove that $\F|_{(\W \cup \K_{\W}(X)\cup \{U\})^{op}}$ is right Kan extended from $\K_{\W}(X)^{op}$.
    Outside of $U$ this is clear from the fact that $F|_{(\W \cup \K_{\W}^{op})}$ is right Kan extended from $\K_{\W}(X)^{op}$.
    This means we only need to prove $\F|_{(\K_{\W}(X)\cup \{U\})^{op}}$ is a right Kan extension of $\F|_{\K_{\W}(X)^{op}}$.
    %\prepp{I'm honestly not entirely sure why we suddenly drop the $\cup W$ part.}
    %\prepp{$(\W \cup \K_{\W}(X) \cup \{U\})^{op} = (\W \cup \K_{\W}(X))^{op, \triangleleft}$}
    Observe that by assumption
    \[
        \F(U)  = \lim_{K\in \K(X)_{/U}^{op}} \F(K) = \lim_{K\in (\K(X)_{/U} \cup \{U\})^{op}} \F(K)
    \]
    so $\F|_{(\K(X)_{/U} \cup \{U\})^{op}}$ is right Kan extended from $\K(X)_{/U}^{op}$.
    Lemma \ref{7.3.4.8} tells us that $\F|_{(\K(X)_{/U})^{op}}$ is a right Kan extension of $\F|_{\K_{\W}(X)^{op}}$.
    We have ${\K_{\W}(X)^{op} \subseteq\Nerve(\K(X)_{/U})^{op} \subseteq (\K(X)_{/U} \cup \{U\})^{op}}$, with Kan extensions as in proposition \ref{4.3.2.8}, so we get that ${\F|_{(\K(X)_{/U} \cup \{U\})^{op}}}$ is right Kan extended from ${(\K_{\W}(X))^{op}}$.
    To summarize, we have the following square of inclusions
    \[\begin{tikzcd}
            {\K_{\W}(X)^{op}} && {(\K_{\W}(X)\cup \{U\})^{op}} \\
            \\
            {\K(X)_{/U}^{op}} && {(\K(X)_{/U} \cup \{U\})^{op}}
            \arrow["{b}", hook, from=1-3, to=3-3]
            \arrow["{j}", hook, from=3-1, to=3-3]
            \arrow["{a}", hook, from=1-1, to=3-1]
            %\arrow[from=1-1, to=3-3]
            \arrow["{i}" ,hook, from=1-1, to=1-3]
        \end{tikzcd}\]
    %where $\F|(\K(X)_{/U} \cup \{U\})^{op} = j_*(\F|\K(X)_{/U})$ and $\F|(\K(X)_{/U})^{op} = j_*(\F|\K_{\W}(X)^{op})$. By applying proposition \ref{4.3.2.8} we see that ${\F|\Nerve(\K(X)_{/U} \cup \{U\})^{op}}= (j \circ a)_*(\F|\K_{\W}(X)^{op})$.
    where $\F|_{(\K(X)_{/U} \cup \{ U \})^{op}} \simeq b_*(\F|_{(\K_{\W} \cup \{U\})^{op}})$ and $\F|_{(\K(X)_{/U} \cup \{U\})^{op}} \simeq (j\circ a)_*(\F|_{\K_{\W}(X)^{op}})$.
    We want to show $\F|_{(\K_{\W}(X) \cup \{U\})^{op}} \simeq i_*(\F|_{\K_{\W}(X)^{op}})$.
    Since $b$ is fully faithful (it is the inclusion of a full subcategory), we know $b^*b_* \simeq \id$, so we get
    \begin{align}
        \F|_{(\K_\W(X)\cup \{U\})^{op}} & \simeq b^*b_*(\F|_{(\K_\W(X)\cup \{U\})^{op}}) \\
                                        & \simeq b^*(j\circ a)_* (\F|_{\K_\W(X)^{op}})   \\
                                        & \simeq b^*(b \circ i)_*(\F|_{\K_\W(X)^{op}})   \\
                                        & \simeq b^*b_*i_*(\F|_{\K_\W(X)^{op}})          \\
                                        & \simeq i_*(\F|_{\K_\W(X)^{op}})
    \end{align}
\end{proof}
\begin{lemma}
    If $\F_{\Open}$ is a sheaf, and $\F$ is a left Kan extension of $\F_{\Open}$, then $\F_{\K}$ is a $\K$-sheaf.
\end{lemma}
\begin{proof}
    By definition we need to show three things:
    Firstly, observe that $\F_{\K}(\emptyset) = \F_{U}(\emptyset)$ and since $\F_{U}$ is a sheaf $\F_{\K}(\emptyset)$ is terminal.
    Secondly, we need the following diagram to be a pullback in $\C$ for any $K,K' \in \K(X)$.
    \begin{equation}\label{K-sheaf-PB}
        \begin{tikzcd}
            {\F(K \cup K')} && {\F(K)} \\
            \\
            {\F(K')} && {\F(K\cap K')}
            \arrow[from=1-3, to=3-3]
            \arrow[from=3-1, to=3-3]
            \arrow[from=1-1, to=3-1]
            %\arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
            \arrow[from=1-1, to=1-3]
        \end{tikzcd}
    \end{equation}
    We will do this by using that $\F_{U}$ is a sheaf.
    Let $P = \{(U,U') | K \subseteq U, K' \subseteq U'\}$ and $\sigma\colon \Delta^1\times\Delta^1 \to \C$ denote diagram \ref{K-sheaf-PB}.
    Now $\F$ induces a map $\sigma_P\colon \Nerve(P^{op})^{\triangleright} \to \C^{\Delta^1\times\Delta^1}$ taking each $(U, U')$ to
    \[
        \begin{tikzcd}
            {\F(U \cup U')} && {\F(U)} \\
            \\
            {\F(U')} && {\F(U\cap U')}
            \arrow[from=1-3, to=3-3]
            \arrow[from=3-1, to=3-3]
            \arrow[from=1-1, to=3-1]
            \arrow["\lrcorner"{anchor=center, pos=0.125}, draw=none, from=1-1, to=3-3]
            \arrow[from=1-1, to=1-3]
        \end{tikzcd}
    \]
    and the cone point is sent to $\sigma$. This is a pullback by the fact that $\F_{U}$ is a sheaf.
    Evaluating $\sigma_P$ in each of the four vertices of $\Delta^1 \times \Delta^1$ we get four maps $\Nerve(P^{op})^{\triangleright} \to \C$.
    We now check that evaluating in the final vertex yields a colimit diagram.
    %Let $Q = \{ U\in \Open(X) | K\cap K' \subseteq U \}$, and observe that this is the fiber product $\Open(X)_{/(K\cap K')}$.
    By assumption $\F$ is a left Kan extension of $\F_{U}$ which by definition means that the following is a colimit diagram:
    \[
        (\Open(X)_{/(K\cap K')})^{op,\triangleright} \hookrightarrow ((\Open(X) \cup \K(X))_{/(K\cap K')})^{op,\triangleright} \xrightarrow{c} (\Open(X) \cup \K(X))^{op} \xrightarrow{\F}\C
    \]
    Observe that for every $U'' \in \Open(X)_{/(K\cap K')}$, the set
    $P_{U''} = \{(U,U') \in P \mid U\cap U' \subseteq U''\}$ is nonempty and stable under finite intersections, which implies it is filtered and hence its nerve is contractible.
    By \ref{superlemma} this implies $P^{op} \to (\Open(X)_{/(K\cap K')})^{op}$ is colimit-cofinal and we get a colimit diagram
    \[
        P^{op,\triangleright} \to(\Open(X)_{/(K\cap K')})^{op,\triangleright} \hookrightarrow (\Open(X) \cup \K(X))_{/(K\cap K')}^{op,\triangleright} \xrightarrow{c} (\Open(X) \cup \K(X))^{op} \xrightarrow{\F}\C.
    \]
    We can show that evaluating the three other vertices also yields colimit diagrams by similar arguments.
    Since $\sigma_P$ yields a colimit diagram when evaluated in each of the four vertices of $\Delta^1 \times \Delta^1$, we conclude that $\sigma_P$ is itself a colimit diagram by \cite[Proposition 5.1.2.2]{HTT}.
    Observe now that $\sigma_P$ is a filtered colimit in $\C$ and hence it is left exact.
    This concludes the argument that \ref{K-sheaf-PB} is a pullback.
    Finally, we need to show that for each $K \in \K(X)$, $\F_{\K}$ is a colimit of $\F_{\K}|_{\K_{K\Subset}(X)^{op}}$.
    We do this by showing
    \[
        \K_{K\Subset}(X)^{op,\triangleright} \to (\K(X) \cup \Open(X))^{op} \xrightarrow{\F} \C
    \]
    is a colimit diagram.
    We use Proposition \ref{4.3.2.8} to show that
    $\F|_{(\Open(X) \cup \K_{K\Subset}(X))^{op}}$ and ${\F|_{(\Open(X) \cup \K_{K\Subset}(X))^{op} \cup \{K\}}}$ are left Kan extensions of $\F|_{\Open(X)^{op}}$ which again implies $\F|_{(\Open(X) \cup \K_{K\Subset}(X))^{op} \cup \{K\}}$ is a left Kan extension of $\F|_{(\Open(X) \cup \K_{K\Subset}(X))^{op}}$.
    Now observe that
    \[
        (\K(X) \cup \Open(X))^{op,\triangleright}_{/K} = (\K_{K\Subset}(X) \cup \Open(X)_{/K})^{op,\triangleright},
    \]
    so in particular
    \[
        (\K(X) \cup \Open(X))^{op,\triangleright}_{/K} \to (\K(X) \cup \Open(X))^{op} \xrightarrow{\F} \C
    \]
    is a colimit diagram, and the statement is reduced to showing that $\K_{K\Subset}(X) \subseteq (\K(X) \cup \Open(X))_{/K}^{op}$ is colimit-cofinal.
    Let $Y\in (\K(X) \cup \Open(X))_{/K}$ and let $R$ be the partially ordered set $\{K' \in \K(X) \midÂ K \Subset K ' \subseteq Y\}$.
    Since $R$ is nonempty and stable under intersections, $R^{op}$ is filtered and hence $\Nerve(R)$ is weakly contractible.
    By \ref{superlemma} the inclusion is colimit-cofinal and we have shown that $\F_\K$ is a $\K$-sheaf.
\end{proof}
\begin{lemma}
    If $\F_{\Open}$ is a sheaf, then $\F$ is a right Kan extension of $\F_{\K}$.
\end{lemma}
\begin{proof}
    We will show $\F$ is a right Kan extension of $\F_\K$ in a similar manner to how we showed $\F$ is a left Kan extension of $\F_{\Open}$ in the start of the proof, but we will consider the partial order on $\Open(X)$ given by writing $V\Subset U$ whenever $V\in \Open(X)$ and its closure $\overline{V}$ is compact and contained in $U$.
    Writing $\Open(X)_{U/}$ for the set $\{V\in \Open(X) \mid V\Subset U\}$, we need to show that
    \[
        \K(X)_{U/}^{op,\triangleleft} \hookrightarrow (\Open(X) \cup \K(X))_{U/}^{op} \xrightarrow{c}(\Open(X) \cup \K(X))^{op} \xrightarrow{\F} \C
    \]
    is a colimit diagram.
    As earlier we do this by finding cofinal inclusions
    \[
        \K(X)_{U/}^{op} \xrightarrow{f}\Nerve(\Open(X) \cup \K(X))_{U/}^{op} \xleftarrow{f'} \K(X)_{/U}^{op}.
    \]
    By Theorem \ref{superlemma} $f$ and $f'$ are colimit-cofinal inclusions if for any $Y\in (\Open(X) \cup \K(X))_{U/}$ the partially ordered sets
    \[
        \{ V \in \Open(X) |Y \subseteq V \Subset U \}
    \]
    and
    \[
        \{ K \in \K(X) |Y \subseteq K \subseteq U \}
    \]
    have weakly contractible nerves, which they have by the usual argument; they are nonempty and stable under unions, hence filtered.
    Since $\Open(X)_{U/}$ is a sieve covering $U$ and $\F_{\Open}$ is a sheaf,
    \[
        \Open(X)_{U/}^{op} \to \Open(X)_{U/}^{op, \triangleleft} \to \C
    \]
    is a colimit diagram and this completes the proof that $\F$ is a right Kan extension of $\F_\K$.
\end{proof}
\begin{corollary}\label{7.3.4.10}
    Let $X$ be a locally compact Hausdorff space and $\C$ an $\infty$-category with left exact filtered colimits and small limits, then $\Shv(X;\C) \simeq \KShv(X;\C)$ is an equivalence of $\infty$-categories.
\end{corollary}
\begin{proof}
    Let $\Shv_{\K\Open}(X;C)$ be the full subcategory of $\Fun((\K(X)\cup \Open(X))^{op},\C)$ spanned by those presheaves satisfying the equivalent conditions of theorem \ref{7.3.4.9}. We get restrictions
    \[
        \Shv(X;\C) \leftarrow \Shv_{\K\Open}(X;C) \to \KShv(X;C),
    \]
    and these are equivalences of $\infty$-categories because inclusions of full subcategories are fully faithful and Kan extensions along fully faithful functors give isomorphisms by Proposition \ref{KanFullyFaithInfty}.
\end{proof}
\end{document}